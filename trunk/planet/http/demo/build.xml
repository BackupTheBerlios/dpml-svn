<?xml version="1.0" encoding="UTF-8" ?>
<!--
 * Copyright 2004 Stephen J. McConnell.
 * Copyright 2004 Niclas Hedman.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.dpml.net/central/about/legal/
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
-->

<project name="dpml-http-demo" default="install" basedir="." 
    xmlns:transit="antlib:net.dpml.transit" xmlns:x="plugin:dpml/magic/dpml-magic-core" >

  <transit:import uri="artifact:template:dpml/magic/standard"/>

  <target name="build" depends="standard.build">

    <types xmlns="plugin:dpml/composition/dpml-composition-builder">
      <type class="net.dpml.http.Demo" threadsafe="true"/>
    </types>

    <x:property name="http.uri" key="dpml-http-impl" feature="uri" type="part"/>

    <component xmlns="plugin:dpml/composition/dpml-composition-builder" 
         name="demo" type="net.dpml.http.Demo" extends="${http.uri}">
      <context>
        <reference key="httpHandler" uri="service:net.dpml.http.spi.FileResourceHandler"/>
        <reference key="socketListener" uri="service:net.dpml.http.spi.SocketListenerService"/>
      </context>
    </component>

    <mkdir dir="target/test"/>
    <copy file="target/deliverables/parts/${project.filename}" toFile="target/test/demo.part"/>

  </target>

  <target name="install" depends="standard.install">
    <x:property name="part.uri" feature="uri" type="part"/>
    <property name="link" value="target/deliverables/parts/${project.name}-LATEST.part.link"/>
    <echo file="${link}">${part.uri}</echo>
  </target>

</project>

