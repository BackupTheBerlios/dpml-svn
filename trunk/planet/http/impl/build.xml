<?xml version="1.0" encoding="UTF-8" ?>
<!--
 * Copyright 2004-2005 Stephen J. McConnell.
 * Copyright 2004 Niclas Hedman.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.dpml.net/central/about/legal/
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
-->

<project name="dpml-http-impl" default="install" basedir="." 
    xmlns:transit="antlib:net.dpml.transit" 
    xmlns:x="plugin:dpml/magic/dpml-magic-core"
    xmlns:c="plugin:dpml/composition/dpml-composition-builder">

  <transit:import uri="artifact:template:dpml/magic/standard"/>

  <target name="build" depends="standard.build">

    <c:types>
      <type class="net.dpml.http.impl.Ajp13Listener" threadsafe="true"/>
      <type class="net.dpml.http.impl.ClientCertAuthenticator" threadsafe="true"/>
      <type class="net.dpml.http.impl.ConfigurationMimeTypes" threadsafe="true"/>
      <type class="net.dpml.http.impl.DumpHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.ErrorPageHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.ExpiryHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.FormAuthenticator" threadsafe="true"/>
      <type class="net.dpml.http.impl.ForwardHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.HashSessionManager" threadsafe="true"/>
      <type class="net.dpml.http.impl.HashUserRealm" threadsafe="true"/>
      <type class="net.dpml.http.impl.HttpContextImpl" threadsafe="true"/>
      <type class="net.dpml.http.impl.HttpServerImpl" threadsafe="true"/>
      <type class="net.dpml.http.impl.IPAccessHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.JaasUserRealm" threadsafe="true"/>
      <type class="net.dpml.http.impl.JsseListener" threadsafe="true"/>
      <type class="net.dpml.http.impl.MsieSslHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.NcsaRequestLog" threadsafe="true"/>
      <type class="net.dpml.http.impl.NotFoundHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.NullHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.ProxyHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.ResourceHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.RootNotFoundHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.SecurityConstraint" threadsafe="true"/>
      <type class="net.dpml.http.impl.SecurityHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.ServletHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.SetResponseHeadersHandler" threadsafe="true"/>
      <type class="net.dpml.http.impl.SocketListener" threadsafe="true"/>
      <type class="net.dpml.http.impl.SystemMimeTypes" threadsafe="true"/>
      <type class="net.dpml.http.impl.WebApplicationContext" threadsafe="true"/>
    </c:types>

    <c:component name="http">
      <parts>
        <component type="net.dpml.http.impl.HttpServerImpl" name="server">
          <context>
            <entry key="trace" value="false"/>
            <entry key="anonymous" value="false"/>
            <entry key="gracefulStop" value="true"/>
            <entry key="requestsPerGC" value="100"/>
          </context>
        </component>
        <component key="requestLog" type="net.dpml.http.impl.NcsaRequestLog">
          <context>
            <entry key="filename" value="$${dpml.data}/logs/http/static_request.log"/>
            <entry key="append" value="true"/>
            <entry key="extended" value="true"/>
          </context>
        </component>
        <component type="net.dpml.http.impl.SocketListener" name="socketListener">
          <context>
            <entry key="httpServer" uri="service:net.dpml.http.spi.HttpService"/>
          </context>
        </component>
        <component name="context" type="net.dpml.http.impl.HttpContextImpl" >
          <context>
            <entry key="name" value="context"/>
            <entry key="server" uri="service:net.dpml.http.spi.HttpService"/>
            <entry key="requestLog" uri="service:org.mortbay.http.RequestLog"/>
            <entry key="tempDirectory">
              <param class="java.io.File" value="urn:system:temp.dir"/>
              <param value="http/context"/>
            </entry>
          </context>
        </component>
        <component name="resourceHandler" type="net.dpml.http.impl.ResourceHandler">
          <context>
            <entry key="name" value="resource-handler"/>
            <entry key="dirAllowed" value="true"/>
            <entry key="allowedMethods" value="GET"/>
            <entry key="httpContext" uri="service:net.dpml.http.spi.HttpContextService"/>
          </context>
        </component>
        <component name="notFoundHandler" type="net.dpml.http.impl.NotFoundHandler">
          <context>
            <entry key="name" value="not-found-handler"/>
            <entry key="httpContext" uri="service:net.dpml.http.spi.HttpContextService"/>
          </context>
        </component>
      </parts>
    </c:component>

  </target>

</project>
