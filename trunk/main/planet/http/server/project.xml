<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="dpml-http-server" basedir="." 
  xmlns="artifact:xsd:dpml/lang/dpml-module#1.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:metro="artifact:xsd:dpml/lang/dpml-component#1.0">

  <types>
    <type xsi:type="metro:component"
        type="net.dpml.http.Server" 
        id="part"
        alias="true">
      <parts xmlns="artifact:xsd:dpml/lang/dpml-component#1.0">
        <!--
        Add a select channel connector to 8080.
        -->
        <component key="plain" type="net.dpml.http.SelectChannelConnector">
          <context>
            <entry key="port" value="8080"/>
            <entry key="maxIdleTime" value="50000"/>
            <entry key="acceptors" value="10"/>
          </context>
        </component>
        <!--
        Add a SSL connector to 8443.
        -->
        <component key="ssl" type="net.dpml.http.SslSocketConnector">
          <context>
            <entry key="port" value="8443"/>
            <entry key="maxIdleTime" value="30000"/>
            <entry key="keyStore" value="local:keystore:dpml/planet/http/sample"/>
            <entry key="keyStorePassword" value="password"/>
            <entry key="certificatePassword" value="password"/>
            <entry key="trustStore" value="local:keystore:dpml/planet/http/certs"/>
            <entry key="trustStorePassword" value="password"/>
          </context>
        </component>
        <!--
        Add a user realm.
        -->
        <component key="realm" type="net.dpml.http.HashUserRealm">
          <context>
            <entry key="name" value="Test Realm"/>
            <entry key="URI" value="local:properties:dpml/planet/http/realm"/>
          </context>
        </component>
        <!--
        Add context handler collection.
        -->
        <component key="contextHandlerCollection" type="net.dpml.http.ContextHandlerCollection">
          <parts>
            <!--
            Creation of a HTTP server configured to present static content in 
            the ${dpml.share}/docs directory.
            -->
            <component key="docs" type="net.dpml.http.ResourceContextHandler">
              <context>
                <entry key="resourceBase" value="${dpml.share}/docs"/>
                <entry key="contextPath" value="/docs"/>
              </context>
            </component>
            <!--
            Add an experimental servlet context.
            (Need to add context cloassloader configuration but this requires 
            per-component threads - currently limited to classes declared within
            the part classloader).
            -->
            <component key="servlets" type="net.dpml.http.ServletContextHandler">
              <context>
                <entry key="resourceBase" value="${dpml.data}"/>
                <entry key="contextPath" value="/data"/>
                <entry key="servletHolders">
                  <param class="net.dpml.http.ServletHolder">
                    <param value="data"/>
                    <param value="org.mortbay.jetty.servlet.DefaultServlet"/>
                  </param>
                </entry>
                <entry key="servletEntries">
                  <param class="net.dpml.http.ServletEntry">
                    <param value="data"/>
                    <param value="/"/>
                  </param>
                </entry>
              </context>
            </component>
            <!--
            Add a web application.
            -->
            <component key="webapp" type="net.dpml.http.WebAppContextHandler">
              <context>
                <entry key="contextPath" value="/"/>
                <entry key="war" value="link:war:dpml/planet/http/dpml-http-app"/>
              </context>
            </component>
          </parts>
        </component>
      </parts>
    </type>
  </types>

  <dependencies>
    <build>
      <include key="dpml-http-app"/>
    </build>
    <runtime>
      <include urn="artifact:jar:org/mortbay/jetty/servlet-api-2.5#${jetty.version}" tag="PUBLIC"/>
      <include key="dpml-http-impl"/>
    </runtime>
  </dependencies>

</project>
