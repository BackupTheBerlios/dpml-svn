<?xml version="1.0" encoding="UTF-8" ?>

<project name="dpml-test-simple-unit" default="install" basedir="."
    xmlns:transit="antlib:net.dpml.transit" 
    xmlns:x="plugin:dpml/magic/dpml-magic-core"
    xmlns:c="plugin:dpml/composition/dpml-composition-builder">

  <transit:import uri="local:template:magic/standard"/>

  <target name="build" depends="standard.build">
    <!--
    Simple component test part.
    This is a simple component with no dependencies.  It is used 
    primarily to validate context entry construction. It includes
    an example of a of a non-trivial custom context entry under the
    'dimension' key. In this example the context entry is an instance 
    of the class Dimension which is created with two int arguments.  
    The DefaultWidget component class accesses this via the Context 
    constructor value and uses it to calculate a size.
    -->
    <c:component dest="target/test/acme-simple.part" 
        type="net.dpml.test.acme.WidgetComponent"
        name="widget">
      <context>
        <entry key="name" feature="name"/>
        <entry key="uri" feature="uri"/>
        <entry key="workingDirectory">
          <param class="java.io.File" value="urn:system:work.dir"/>
          <param value="acme/workspace"/>
        </entry>
        <entry key="dimension" class="net.dpml.test.acme.DimensionValue">
          <param class="int" value="12"/>
          <param class="int" value="100"/>
        </entry>
      </context>
    </c:component>

    <!--
    Simple component example.
    In this example we substitute the creation of a simple value type
    with a component as a declaration directly inside the context
    element.  This example demonstrates the mixing of different component
    strategies and the ability of a component to be handled without 
    explicit management.  The example also shows the usage of an symbolic
    system property reference passes as an argument to the working directory
    context entry value.
    -->
    <c:component dest="target/test/acme-widget.part" 
        type="net.dpml.test.acme.WidgetComponent"
        name="widget">
      <context>
        <entry key="name" feature="name"/>
        <entry key="uri" feature="uri"/>
        <entry key="workingDirectory" value="$${user.dir}"/>
        <component key="dimension" type="net.dpml.test.acme.DimensionComponent">
          <context>
            <entry key="width" value="12"/>
            <entry key="height" value="100"/>
          </context>
        </component>
      </context>
    </c:component>

    <!--
    Example component.
    -->
    <c:component dest="target/test/acme-example-one.part" 
        type="net.dpml.test.acme.ExampleComponent"
        name="demo">
      <context>
        <entry key="dimension" class="net.dpml.test.acme.DimensionValue">
          <param class="int" value="2"/>
          <param class="int" value="5"/>
        </entry>
      </context>
    </c:component>

    <!--
    Example component using a nested dimension component.
    -->
    <c:component dest="target/test/acme-example-two.part" 
        type="net.dpml.test.acme.ExampleComponent"
        name="nested">
      <context>
        <component key="dimension" type="net.dpml.test.acme.DimensionComponent">
          <context>
            <entry key="width" value="12"/>
            <entry key="height" value="100"/>
          </context>
        </component>
      </context>
    </c:component>

    <!--
    Example component using an internal part.
    -->
    <c:component dest="target/test/acme-example-three.part" 
        type="net.dpml.test.acme.ExampleContainer"
        name="internal">
      <parts>
        <component name="dimension" type="net.dpml.test.acme.DimensionComponent"/>
      </parts>
    </c:component>

    <!--
    Example component using a part by reference.
    -->
    <x:property key="dpml-test-simple" feature="uri" type="part" name="acme.uri"/>
    <c:component dest="target/test/acme-example-four.part" 
        type="net.dpml.test.acme.ExampleContainer"
        name="reference">
      <parts>
        <part key="dimension" uri="${acme.uri}"/>
      </parts>
    </c:component>

    <!-- 
    Composite component example.
    This is a example of a composite component (the AcmeContainer class)
    with parts that it manages.  The parts include a gizmo and widget    
    component which are automatically resolved by the container and supplied
    to the AcmeContainer component via the Parts constructor argument. 
    Note that we are not including the Dimension arguments in the context
    thereby demonstrating optional context entry semantic. A feature of 
    this example is the usage of a reference element as the mechanisms
    to wire the context 'widget' part into the context supplied to the 
    'gizmo' component.  Wiring of dependencies is explicit and handled 
    by the value uri within Gizmo's context.  The reference element
    declares that the context entry for the key 'widget', supplied to 
    Gizmo shall be the selected from the 'parts' of the enclosing component
    using the name 'widget' (where the uri is in the form [scope]:[name] and
    scope may be one of 'context' or 'parts' refering respectivly to the 
    enclosing components parts or context).
    -->
    <c:component dest="target/test/acme-container.part"
        type="net.dpml.test.acme.AcmeContainer"
        name="acme">
      <parts>
        <component name="widget" type="net.dpml.test.acme.WidgetComponent">
          <context>
            <entry key="workingDirectory">
              <param class="java.io.File" value="urn:system:work.dir"/>
              <param value="acme/workspace"/>
            </entry>
            <entry key="name" feature="name"/>
            <entry key="uri" feature="uri"/>
          </context>
        </component>
        <component name="gizmo" type="net.dpml.test.acme.GizmoComponent">
          <context>
            <entry key="color" value="red"/>
            <entry key="widget" uri="service:net.dpml.test.acme.Widget"/>
          </context>
        </component>
      </parts>
    </c:component>

    <!--
    Composite component example.
    Using the same container as above, the following example demonstrates the 
    replacement of the DefaultWidget component with an alternative implementation
    using the SimpleWidget type.
    -->
    <c:component dest="target/test/acme-test-container.part"
        type="net.dpml.test.acme.AcmeContainer"
        name="composite">
      <parts>
        <component name="widget" type="net.dpml.test.acme.SimpleWidget"/>
        <component name="gizmo" type="net.dpml.test.acme.GizmoComponent">
          <context>
            <entry key="color" value="red"/>
            <entry key="widget" uri="service:net.dpml.test.acme.Widget"/>
          </context>
        </component>
      </parts>
    </c:component>

    <!--
    Example using the BadWidget
    -->
    <c:component dest="target/test/acme-bad-widget.part"
        type="net.dpml.test.acme.AcmeContainer"
        name="bad">
      <parts>
        <component name="widget" type="net.dpml.test.acme.BadWidget"/>
        <component name="gizmo" type="net.dpml.test.acme.GizmoComponent">
          <context>
            <entry key="color" value="red"/>
            <entry key="widget" uri="service:net.dpml.test.acme.Widget"/>
          </context>
        </component>
      </parts>
    </c:component>

  </target>

  <target name="package" depends="build"/>
  <target name="install" depends="test"/>

</project>
