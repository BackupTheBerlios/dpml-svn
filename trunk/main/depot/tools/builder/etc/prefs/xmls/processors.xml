<?xml version="1.0" encoding="UTF-8" ?>

<!--
Default configuration for Depot-on-Ant.
Status: work-in-progress
-->

<configuration>

  <phases>
   
    <phase name="init">
    
      <process name="setup">
        <produces>
          <dir path="${basedir}/etc" name="etc"/>
          <dir path="${basedir}/src" name="src"/>
          <dir path="${basedir}/target" name="target"/>
          <dir path="${etc}/main" name="etc.main"/>
          <dir path="${etc}/test" name="etc.test"/>
          <dir path="${etc}/prefs" name="etc.prefs"/>
          <dir path="${etc}/bin" name="etc.bin"/>
          <dir path="${etc}/deliverables" name="etc.deliverables"/>
          <dir path="${etc}/docs" name="etc.docs"/>
          <dir path="${src}/main" name="src.main"/>
          <dir path="${src}/docs" name="src.docs"/>
          <dir path="${src}/test" name="src.test"/>
        </produces>
      </process>

    </phase>
    
    <phase name="prepare" depends="init">
    
      <process name="prepare-prefs">
        <consumes>
          <ref id="etc.prefs"/>
        </consumes>
        <produces>
          <dir path="${target}/prefs" name="target.prefs"/>
        </produces>
      </process>

      <process name="prepare-deliverables">
        <consumes>
          <ref id="etc.deliverables"/>
        </consumes>
        <produces>
          <dir path="${target}/deliverables" name="target.deliverables"/>
        </produces>
      </process>
  
      <process name="prepare-main">
        <consumes>
          <ref id="target"/>
          <ref id="etc.main" optional="true"/>
          <ref id="src.main" optional="true"/>
        </consumes>
        <produces>
          <dir path="${target}/build/main" name="target.build.main"/>
        </produces>
      </process>

      <process name="prepare-test">
        <consumes>
          <ref id="etc.test" optional="true"/>
          <ref id="src.test" optional="true"/>
        </consumes>
        <produces>
          <dir path="${target}/build/test" name="target.build.test"/>
        </produces>
      </process>
      
      <process name="prepare-docs">
        <consumes>
          <ref id="etc.docs" optional="true"/>
          <ref id="src.docs" optional="true"/>
        </consumes>
        <produces>
          <dir path="${target}/build/docs" name="target.build.docs"/>
        </produces>
      </process>
      
    </phase>
    
    <phase name="build" depends="prepare">
      
      <process name="build-main">
        <consumes>
          <ref id="target.build.main" optional="true"/>
        </consumes>
        <produces>
          <dir path="${target}/classes/main" name="target.classes.main"/>
        </produces>
      </process>
      
      <process name="build-test">
        <consumes>
          <ref id="target.build.test" optional="true"/>
        </consumes>
        <produces>
          <dir path="${target}/classes/test" name="target.classes.test"/>
        </produces>
      </process>
      
    </phase>
    
    <phase name="package" depends="build">
    
      <process name="jar">
        <consumes>
          <ref id="target.deliverables"/>
          <ref id="target.classes.main" optional="true"/>
        </consumes>
        <produces>
          <resource base="{target.deliverables}" name="target.deliverables.jar"/>
        </produces>
      </process>

      <process name="part" id="part">
        <consumes>
          <ref id="target.deliverables.jar" optional="true"/>
        </consumes>
        <produces>
          <resource base="{target.deliverables}" name="target.deliverables.part"/>
        </produces>
      </process>

    </phase>
    
    <phase name="test" depends="package">

      <process name="unit-test">
        <consumes>
          <ref id="target.classes.test" optional="true"/>
          <ref id="target.deliverables.jar" optional="true"/>
        </consumes>
        <produces>
          <dir path="${target}/reports/test" name="target.reports.test"/>
        </produces>
      </process>

    </phase>
    
    <phase name="install" depends="test">

      <process name="prefs">
        <consumes>
          <ref id="target.prefs"/>
        </consumes>
        <produces>
          <collection layout="classic" base="${dpml.prefs}" name="prefs"/>
        </produces>
      </process>

      <process name="deliverables">
        <consumes>
          <ref id="target.deliverables"/>
        </consumes>
        <produces>
          <collection layout="classic" base="${dpml.cache}"  name="cache"/>
        </produces>
      </process>

    </phase>
    
    <phase name="clean" depends="init">

      <process name="purge">
        <consumes>
          <ref id="target"/>
        </consumes>
      </process>
    
    </phase>
    
  </phases>
    
</configuration>

