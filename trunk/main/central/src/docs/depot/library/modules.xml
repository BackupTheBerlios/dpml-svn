<?xml version="1.0" encoding="UTF-8"?>

<document>

  <properties>
    <author email="mcconnell@dpml.net">Stephen McConnell</author>
    <title>DPML Depot Module Declarations</title>
  </properties> 

  <body>

    <section name="Modules">

      <p>
      A module can be viewed as a collection of resources and projects 
      that share a common group name.  In effect a module establishes a 
      unique namespace for the resources contained within it.  A module
      can contain its own <tt>type</tt> declarations together with 
      nested <tt>resource</tt>, <tt>project</tt> and subsidiary 
      <tt>module</tt> delcarations.
      </p>

      <p>
      Functionally a module can be view as a resource or project in that
      a module can declare a <tt>basedir</tt> and produced <tt>types</tt>.
      The enables a module to be used as a source for the production of
      module related information (such as a module descriptor or module 
      documentation).
      </p>

      <subsection name="XML Attributes on Embedded Modules">

         <p>
         The following attributes may be declared when declaring a 
         module within the library <tt>&lt;modules&gt;</tt> element or within
         another enclosing <tt>&lt;module&gt;</tt>
         </p>
      
         <table>
           <tr>
             <td>name</td>
             <td>The module name (required). A module path is made up of the sequence 
              of modules names of any parent modules and the immediate module 
              name.</td>
           </tr>
           <tr>
             <td>version</td>
             <td>The module version (mornally not declared).</td>
           </tr>
           <tr>
             <td>basedir</td>
             <td>Optional base directory of the module.</td>
           </tr>
         </table>

      </subsection>

      <subsection name="XML Attributes on Module Includes">

         <p>
         An alternative form of module definition is supported whereby 
         a <tt>file</tt> attribute reference a module fragment relative filename.  
         The module basedir is resolved relative to the filename parent directory
         and the module <tt>name</tt> is resolved from the imported file <tt>&lt;module&gt;</tt> 
         element.  This second form of module addition is convinient when you are 
         dealing with a large number of projects.
         </p>
      
         <table>
           <tr>
             <td>file</td>
             <td>A path relative to the imnporting module referencing an XML file 
              containing a <tt>&lt;module&gt;</tt> root document element.</td>
           </tr>
         </table>

      </subsection>

      <subsection name="XML Nested elements">
      
         <table>
           <tr>
             <td><a href="types.html">types</a></td>
             <td>0..1</td>
             <td>
             The declaration of a &lt;types&gt; element within a module associates
             one or more an artifact types within the module's fully qualified name.
             For example, it is possible to create an portable defintion of top-level modules
             using a specialized ant tasks.  The ant task produced an artifact of the 
             type 'module'.  By declaring the type 'module' as a type produced by the 
             module a build system can automate the production of the module artifact.  
             </td>
           </tr>
           <tr>
             <td><a href="resources.html">resource</a></td>
             <td>0..n</td>
             <td>A resource declaration.</td>
           </tr>
           <tr>
             <td><a href="projects.html">project</a></td>
             <td>0..n</td>
             <td>A project declaration.</td>
           </tr>
           <tr>
             <td>module</td>
             <td>0..n</td>
             <td>A nested module declaration.</td>
           </tr>
         </table>

      </subsection>

    </section>

    <section name="Examples">

      <subsection name="Embedded Module Declaration">

      <p>
      The following example demonstrates the declaration of a single module 
      directly within a library.  The module declares the name 'demo' and 
      base directory corresponding to the same directory that the library is 
      located within.  The module contains a single project named 'example'.
      </p>

<source><![CDATA[
<library>

  <properties>
    <property name="project.builder.uri" value="link:plugin:dpml/tools/dpml-tools-builder"/>
    <property name="project.standard.template" value="local:template:dpml/tools/standard"/>
    <property name="project.template" value="${project.standard.template}"/>
  </properties>

  <modules>
    <module name="demo" basedir=".">
      <project name="example" basedir="example">
        <types>
          <type id="jar"/>
        </types>
        <dependencies>
          <include urn="artifact:jar:commons-collections/commons-collections#3.0"/>
        </dependencies>
      </project>
    </module>
  </modules>

</library>

]]></source>

      </subsection>

      <subsection name="Imported Module Declaration">

      <p>
      The following example demonstrates the inclusion of a series of external 
      files named <tt>module.xml</tt> as the definition of a set of modules.  The 
      example declares a root module named 'dpml'.  A set of <tt>module</tt> elements
      delcarations reference external modules for 'transit', 'metro', 'depot', 
      and 'util'.  In each case the the directory referenced by the base attribute
      contains a file named <tt>module.xml</tt>.
      </p>

<source><![CDATA[
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE library PUBLIC "-//DPML//DTD Library 1.0//EN" "http://download.dpml.net/dtds/library_1_0.dtd" >

<library>

  <imports>
    <import uri="link:module:junit"/>
    <import uri="link:module:ant"/>
    <import uri="link:module:jgoodies"/>
  </imports>

  <modules>

    <module name="dpml" basedir=".">

      <properties>
        <property name="project.publisher.name" value="Digital Product Meta Library"/>
        <property name="project.specification.vendor" value="${project.publisher.name}"/>
        <property name="project.implementation.vendor" value="${project.publisher.name}"/>
        <property name="project.implementation.vendor-id" value="net.dpml"/>
        <property name="project.publisher.url" value="http://www.dpml.net"/>
        <property name="project.resource.host" value="http://repository.dpml.net"/>
        <property name="project.api.host" value="http://api.dpml.net"/>
        <property name="project.svn.host" value="svn://svn.berlios.de/dpml/trunk/main"/>
        <property name="project.javadoc.linksource" value="true"/>
      </properties>

      <types>
        <type id="module" alias="true"/>
      </types>

      <module file="transit/module.xml"/>
      <module file="metro/module.xml"/>
      <module file="depot/module.xml"/>
      <module file="util/module.xml"/>
      <module file="planet/module.xml"/>

      <project name="central" basedir="central"/>

    </module>

  </modules>

</library>

]]></source>

        <p>
        The following XML is an example of an imported <tt>module.xml</tt> file.  The example 
        used below is the DPML Depot Module.
        </p>

<source><![CDATA[
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE module PUBLIC "-//DPML//DTD Library 1.0//EN" "http://download.dpml.net/dtds/library_1_0.dtd" >

<module name="depot">
   
  <project name="dpml-library-build" basedir="library/console">
    <types>
      <type id="jar"/>
      <type id="plugin" alias="true">
        <property name="project.plugin.class" 
           value="net.dpml.library.console.BuilderPlugin"/>
      </type>
    </types>
    <dependencies>
      <include ref="dpml/util/dpml-util-cli"/>
      <include ref="dpml/transit/dpml-transit-main"/>
      <include ref="dpml/depot/dpml-library"/>
    </dependencies>
    <dependencies scope="test">
      <include ref="ant/ant-junit"/>
    </dependencies>
  </project>
      
  <project name="dpml-depot-checkstyle" basedir="tools/checkstyle">
    <types>
      <type id="jar"/>
      <type id="plugin" alias="true">
        <property name="project.plugin.resource" 
          value="net/dpml/tools/checkstyle/antlib.xml"/>
        <property name="project.plugin.urn" 
          value="dpml:checkstyle"/>
      </type>
    </types>
    <dependencies>
      <include ref="dpml/depot/dpml-tools-builder"/>
      <include urn="artifact:jar:checkstyle/checkstyle#4.1">
        <property name="project.api.host" value="http://api.dpml.net"/>
        <property name="project.api.root" value="${project.api.host}/${group}/${version}"/>
      </include>
      <include urn="artifact:jar:commons-logging/commons-logging#1.0.4" />
      <include urn="artifact:jar:commons-collections/commons-collections#3.1" />
      <include urn="artifact:jar:commons-beanutils/commons-beanutils-core#1.7.0" />
      <include urn="artifact:jar:bcel/bcel#5.1" />
      <include urn="artifact:jar:antlr/antlr#2.7.2" />
    </dependencies>
  </project>

  <project name="dpml-depot-convert" basedir="tools/convert">
    <types>
      <type id="jar"/>
      <type id="plugin" alias="true">
        <property name="project.plugin.resource" 
          value="net/dpml/tools/convert/antlib.xml"/>
        <property name="project.plugin.urn" 
          value="dpml:convert"/>
      </type>
    </types>
    <dependencies>
      <include urn="artifact:jar:java2html/java2html#4.2"/>
      <include ref="ant/ant-launcher"/>
    </dependencies>
  </project>

  <project name="dpml-depot-core" basedir="core/console">
    <properties>
      <property name="project.jar.main.class" value="net.dpml.depot.Main"/>
    </properties>
    <types>
      <type id="jar"/>
    </types>
    <dependencies>
      <include ref="dpml/transit/dpml-transit-main"/>
    </dependencies>
    <dependencies scope="test">
      <include ref="ant/ant-junit"/>
    </dependencies>
  </project>

  <resource name="dpml-tools-builder" basedir="tools/builder">
    <types>
      <type id="jar"/>
      <type id="plugin" alias="true">
        <property name="project.plugin.class" 
          value="net.dpml.tools.impl.StandardBuilder"/>
      </type>
    </types>
    <dependencies>
      <include ref="dpml/depot/dpml-library"/>
      <include ref="dpml/transit/dpml-transit-tools"/>
      <include ref="ant/ant-junit" tag="system"/>
      <include ref="ant/ant" tag="system"/>
      <include ref="ant/ant-xslp" tag="system"/>
      <include ref="ant/ant-trax" tag="system"/>
    </dependencies>
  </resource>

</module>
]]></source>

      </subsection>

    </section>

  </body>

</document>

