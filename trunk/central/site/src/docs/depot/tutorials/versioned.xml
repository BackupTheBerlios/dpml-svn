<?xml version="1.0" encoding="ISO-8859-1"?>

<document>
  <properties>
    <author email="mcconnell@osm.net">Stephen McConnell</author>
    <title>Version Builds</title>
  </properties>

  <body>

    <section name="Versioned Builds">

      <subsection name="Tutorial Objective">

        <p>
        The objective of this tutorial is to demonstrate the usage of 
        the <tt>-version</tt> option when building multiple projects.
        </p>

      </subsection>

      <subsection name="Executing a versioned build">

        <p>
        By default the build system assigns the version identifier of 
        <tt>SNAPSHOT</tt>.  
        </p>
        <p>
        We can override this using the <tt>-version</tt> 
        commandline option.
        </p>

<pre>$ build -version 1.0.0
[1940 ] [INFO   ] (depot.build): Initiating build sequence: (3)

  (1)   org/acme/clock-api
  (2)   org/acme/clock-impl
  (3)   org/acme


-------------------------------------------------------------------------
org/acme/clock-api#1.0.0
-------------------------------------------------------------------------

init:

prepare:
[x:prepare] Created dir: D:\dpml\tutorials\tooling\complex\export\api\target
[x:prepare] Created dir: D:\dpml\tutorials\tooling\complex\export\api\target\build\main
[x:prepare] Copying 1 file to D:\dpml\tutorials\tooling\complex\export\api\target\build\main

build:
    [javac] Created dir: D:\dpml\tutorials\tooling\complex\export\api\target\classes\main
    [javac] Compiling 1 source file to D:\dpml\tutorials\tooling\complex\export\api\target\classes\main

package:
      [jar] Created dir: D:\dpml\tutorials\tooling\complex\export\api\target\deliverables\jars
      [jar] Building jar: D:\dpml\tutorials\tooling\complex\export\api\target\deliverables\jars\clock-api-1.0.0.jar
      [jar] Creating md5 checksum

test:

install:
[x:install] Copying 2 files to D:\system\dpml\data\cache\org\acme

BUILD SUCCESSFUL
Total time: 3 seconds

-------------------------------------------------------------------------
org/acme/clock-impl#1.0.0
-------------------------------------------------------------------------

init:

prepare:
[x:prepare] Created dir: D:\dpml\tutorials\tooling\complex\export\impl\target
[x:prepare] Created dir: D:\dpml\tutorials\tooling\complex\export\impl\target\build\main
[x:prepare] Copying 1 file to D:\dpml\tutorials\tooling\complex\export\impl\target\build\main
[x:prepare] Created dir: D:\dpml\tutorials\tooling\complex\export\impl\target\build\test
[x:prepare] Copying 1 file to D:\dpml\tutorials\tooling\complex\export\impl\target\build\test
[x:prepare] Created dir: D:\dpml\tutorials\tooling\complex\export\impl\target\test

build:
    [javac] Created dir: D:\dpml\tutorials\tooling\complex\export\impl\target\classes\main
    [javac] Compiling 1 source file to D:\dpml\tutorials\tooling\complex\export\impl\target\classes\main
    [javac] Created dir: D:\dpml\tutorials\tooling\complex\export\impl\target\classes\test
    [javac] Compiling 1 source file to D:\dpml\tutorials\tooling\complex\export\impl\target\classes\test

package:
      [jar] Created dir: D:\dpml\tutorials\tooling\complex\export\impl\target\deliverables\jars
      [jar] Building jar: D:\dpml\tutorials\tooling\complex\export\impl\target\deliverables\jars\clock-impl-1.0.0.jar
      [jar] Creating md5 checksum

test:
    [junit] Created dir: D:\dpml\tutorials\tooling\complex\export\impl\target\reports\test
    [junit] Executing forked test.
    [junit] Running org.acme.impl.test.DemoTestCase
    [junit] [37920] [INFO   ] (test): 0:27 AM, CST
    [junit] Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 0.203 sec

install:
[x:install] Copying 2 files to D:\system\dpml\data\cache\org\acme

BUILD SUCCESSFUL
Total time: 2 seconds

-------------------------------------------------------------------------
org/acme#1.0.0
-------------------------------------------------------------------------

init:

prepare:
[x:prepare] Created dir: D:\dpml\tutorials\tooling\complex\export\target

build:

package:
   [module] Exporting module to: D:\dpml\tutorials\tooling\complex\export\target\deliverables\modules\acme-1.0.0.module

test:

install:
[x:install] acme-1.0.module.link
[x:install] artifact:module:org/acme#1.0.0
[x:install] Copying 2 files to D:\system\dpml\data\cache\org

BUILD SUCCESSFUL
Total time: 1 second

$</pre>

      </subsection>
      
      <subsection name="The Generated Module">

<source><font color="blue"><![CDATA[<?xml version="1.0" encoding="ISO-8859-1"?>
<module name="org/acme" version="1.0.0"
    xmlns="link:xsd:dpml/lang/dpml-module#1.0">

  <types>
    <type id="module" version="1.0"/>
  </types>

  <resource name="clock-api" version="1.0.0">
    <types>
      <type id="jar"/>
    </types>
  </resource>

  <resource name="clock-impl" version="1.0.0">
    <types>
      <type id="jar"/>
    </types>
    <dependencies>
      <runtime>
        <include ref="org/acme/clock-api"/>
      </runtime>
    </dependencies>
  </resource>

</module>]]></font></source>

      </subsection>
    
      <subsection name="Summary">

        <p>
        The above sequence demonstrates the impact of the <tt>-version</tt> option 
        in terms of resource naming and the corresponding meta-data (such as module
        information) that is generated by the build process.  All of the resources
        (jars, module files, etc.) are now suitable for publication into a public
        (or shared) repository.
        </p>
        
      </subsection>
      
    </section>

  </body>
  
</document>

